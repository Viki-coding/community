{% extends "base.html" %} 
{% block title %}USER DASHBOARD{% endblock %}

{% block content %}
<div class="dashboard-container">
  <h2>My Booked Events</h2>
  <div class="alert alert-success">
      Congratulations, {{ user.username }}! You are now logged in.
  </div>

  {% for booking in bookings %}
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Event</th>
          <th>Date</th>
          <th>Time</th>
          <th>Location</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for booking in bookings %}
        <tr>
          <td>{{ booking.event.title }}</td>
          <td>{{ booking.event.start_date|date:"j, F , Y" }}</td>
          <td>{{ booking.event.start_time }} - {{ booking.event.end_time }}</td>
          <td>{{ booking.event.location }}</td>
          <td>
            <a href="{% url 'event_detail' booking.event.id %}" class="btn btn-info btn-sm">View</a>
            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#cancelModal" data-booking-id="{{ booking.id }}">Cancel</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
  {% empty %}
  <p>You have not booked any events yet.</p>
  {% endfor %}
</div>


  <!-- <div class="bookings-list">
    {% for booking in bookings %}
    <div class="booking-item">
        <strong>{{ booking.event.title }}</strong><br>
        üìÖ {{ booking.event.start_date|date:"j, F , Y" }}  
        üïí {{ booking.event.start_time }} - {{ booking.event.end_time }}  
        üìç {{ booking.event.location }}<br>
        <p>{{ booking.event.description }}</p>
        <div class="booking-actions">
          <a href="{% url 'event_detail' booking.event.id %}" class="btn view-event">View Event</a>
          <button type="button" class="btn cancel-booking" data-bs-toggle="modal" data-bs-target="#cancelModal" data-booking-id="{{ booking.id }}">Cancel Booking</button>
          <a href="{% url 'index' %}" class="btn view-events">View Events</a>
        </div>
      </div>
        <a href="{% url 'event_detail' booking.event.id %}" class="btn btn-info">View Event Detail</a>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#cancelModal" data-booking-id="{{ booking.id }}">Cancel Booking</button>
      </div>
  </div> -->
  <!-- {% empty %}
    <p>You have not booked any events yet.</p>
  {% endfor %}
  </div>
</div> -->

<!-- Cancel Booking Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="cancelModalLabel">Confirm Cancellation</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              Are you sure you want to cancel this booking?
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <form id="cancelForm" method="post" action="">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger">Cancel Booking</button>
              </form>
          </div>
      </div>
  </div>
</div>

<script>
  var cancelModal = document.getElementById('cancelModal');
  cancelModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var bookingId = button.getAttribute('data-booking-id');
      var form = document.getElementById('cancelForm');
      form.action = "{% url 'cancel_booking' 0 %}".replace('0', bookingId);
  });
</script>
{% endblock %}